var Zt=Object.defineProperty;var $t=(e,t,n)=>t in e?Zt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var ht=(e,t,n)=>($t(e,typeof t!="symbol"?t+"":t,n),n);class te extends Error{constructor(t){super(t)}__promptsError__(){}}function ee(e){return typeof e=="object"&&e!==null&&typeof e.__promptsError__=="function"}class vt{constructor(t){this.list=t.prompts,this.groups=t.groups,this.fieldGroups=t.fieldGroups}static async load(){const t=await fetch("/actions/gpt-content-generator/prompts/get");return new vt(await t.json())}get(t){return t=parseInt(t),this.list.find(n=>n.id===t)}getByGroup(t){return this.list.filter(n=>n.group===t)}getGroup(t){return this.groups.find(n=>n.key===t)}getFieldGroup(t){return this.fieldGroups[t]??null}async save(t){const n=new FormData;t.id&&n.set("id",t.id),n.set("name",t.name),n.set("prompt",t.prompt),n.set("group",t.group);const l=await fetch("/actions/gpt-content-generator/prompts/save",{method:"POST",body:n,headers:{Accept:"application/json"}});if(!l.ok)throw new Error("not ok");return t=await l.json(),this.list.find(r=>r.id!=t.id?!1:(r.name=t.name,r.prompt=t.prompt,r.group=t.group,!0))||this.list.push(t),t}async del(t){const n=new FormData;if(n.set("id",t.id),!(await fetch("/actions/gpt-content-generator/prompts/delete",{method:"POST",body:n,headers:{Accept:"application/json"}})).ok)throw new Error("not ok");this.list=this.list.filter(o=>o.id!==t.id)}async execute(t,n){const l=new FormData;l.set("prompt",t),l.set("context",JSON.stringify(n));const o=await fetch("/actions/gpt-content-generator/prompts/execute",{method:"POST",body:l,headers:{Accept:"application/json"}});if(!o.ok)throw new Error("not ok");const r=await o.json();if(r!=null&&r.error)throw new te(r.error);return r}}class yt{constructor(t){this.list=t.fields,this.fieldGroups=t.fieldGroups,(!t.fieldGroups||Array.isArray(t.fieldGroups))&&(this.fieldGroups={})}static async load(){const t=await fetch("/actions/gpt-content-generator/settings/get-fields");return new yt(await t.json())}getCombined(){return this.list.map(t=>{const{id:n,handle:l,type:o,name:r}=t;return{id:n,handle:l,type:o,name:r,group:this.fieldGroups[n]??""}})}async saveFieldGroups(t){const n=new FormData;n.set("fieldGroups",JSON.stringify(t));const l=await fetch("/actions/gpt-content-generator/settings/save-field-groups",{method:"POST",body:n,headers:{Accept:"application/json"}});if(!l.ok)throw new Error("not ok");this.fieldGroups=await l.json()}}function I(){}function Ht(e){return e()}function Pt(){return Object.create(null)}function J(e){e.forEach(Ht)}function xt(e){return typeof e=="function"}function Y(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function ne(e){return Object.keys(e).length===0}const le=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function s(e,t){e.appendChild(t)}function T(e,t,n){e.insertBefore(t,n||null)}function N(e){e.parentNode&&e.parentNode.removeChild(e)}function ut(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function m(e){return document.createElement(e)}function A(e){return document.createTextNode(e)}function v(){return A(" ")}function Rt(){return A("")}function O(e,t,n,l){return e.addEventListener(t,n,l),()=>e.removeEventListener(t,n,l)}function Vt(e){return function(t){return t.preventDefault(),e.call(this,t)}}function p(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function oe(e){return Array.from(e.childNodes)}function z(e,t){t=""+t,e.data!==t&&(e.data=t)}function R(e,t){e.value=t??""}function dt(e,t,n){for(let l=0;l<e.options.length;l+=1){const o=e.options[l];if(o.__value===t){o.selected=!0;return}}(!n||t!==void 0)&&(e.selectedIndex=-1)}function zt(e){const t=e.querySelector(":checked");return t&&t.__value}function re(e,t,{bubbles:n=!1,cancelable:l=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:l})}let it;function rt(e){it=e}function Wt(){if(!it)throw new Error("Function called outside component initialization");return it}function wt(e){Wt().$$.on_mount.push(e)}function ft(){const e=Wt();return(t,n,{cancelable:l=!1}={})=>{const o=e.$$.callbacks[t];if(o){const r=re(t,n,{cancelable:l});return o.slice().forEach(c=>{c.call(e,r)}),!r.defaultPrevented}return!0}}const nt=[],_t=[];let lt=[];const Lt=[],Ut=Promise.resolve();let bt=!1;function Jt(){bt||(bt=!0,Ut.then(Kt))}function St(){return Jt(),Ut}function st(e){lt.push(e)}const gt=new Set;let et=0;function Kt(){if(et!==0)return;const e=it;do{try{for(;et<nt.length;){const t=nt[et];et++,rt(t),ie(t.$$)}}catch(t){throw nt.length=0,et=0,t}for(rt(null),nt.length=0,et=0;_t.length;)_t.pop()();for(let t=0;t<lt.length;t+=1){const n=lt[t];gt.has(n)||(gt.add(n),n())}lt.length=0}while(nt.length);for(;Lt.length;)Lt.pop()();bt=!1,gt.clear(),rt(e)}function ie(e){if(e.fragment!==null){e.update(),J(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(st)}}function se(e){const t=[],n=[];lt.forEach(l=>e.indexOf(l)===-1?t.push(l):n.push(l)),n.forEach(l=>l()),lt=t}const at=new Set;let X;function ce(){X={r:0,c:[],p:X}}function ue(){X.r||J(X.c),X=X.p}function ot(e,t){e&&e.i&&(at.delete(e),e.i(t))}function ct(e,t,n,l){if(e&&e.o){if(at.has(e))return;at.add(e),X.c.push(()=>{at.delete(e),l&&(n&&e.d(1),l())}),e.o(t)}else l&&l()}function U(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function kt(e){e&&e.c()}function pt(e,t,n){const{fragment:l,after_update:o}=e.$$;l&&l.m(t,n),st(()=>{const r=e.$$.on_mount.map(Ht).filter(xt);e.$$.on_destroy?e.$$.on_destroy.push(...r):J(r),e.$$.on_mount=[]}),o.forEach(st)}function mt(e,t){const n=e.$$;n.fragment!==null&&(se(n.after_update),J(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function ae(e,t){e.$$.dirty[0]===-1&&(nt.push(e),Jt(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Z(e,t,n,l,o,r,c=null,d=[-1]){const a=it;rt(e);const u=e.$$={fragment:null,ctx:[],props:r,update:I,not_equal:o,bound:Pt(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(a?a.$$.context:[])),callbacks:Pt(),dirty:d,skip_bound:!1,root:t.target||a.$$.root};c&&c(u.root);let f=!1;if(u.ctx=n?n(e,t.props||{},(i,h,..._)=>{const L=_.length?_[0]:h;return u.ctx&&o(u.ctx[i],u.ctx[i]=L)&&(!u.skip_bound&&u.bound[i]&&u.bound[i](L),f&&ae(e,i)),h}):[],u.update(),f=!0,J(u.before_update),u.fragment=l?l(u.ctx):!1,t.target){if(t.hydrate){const i=oe(t.target);u.fragment&&u.fragment.l(i),i.forEach(N)}else u.fragment&&u.fragment.c();t.intro&&ot(e.$$.fragment),pt(e,t.target,t.anchor),Kt()}rt(a)}class ${constructor(){ht(this,"$$");ht(this,"$$set")}$destroy(){mt(this,1),this.$destroy=I}$on(t,n){if(!xt(n))return I;const l=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return l.push(n),()=>{const o=l.indexOf(n);o!==-1&&l.splice(o,1)}}$set(t){this.$$set&&!ne(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const de="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(de);function At(e,t,n){const l=e.slice();return l[4]=t[n],l}function fe(e){let t,n,l,o,r,c,d=U(e[0].list),a=[];for(let u=0;u<d.length;u+=1)a[u]=Ft(At(e,d,u));return{c(){t=m("div"),n=m("div"),l=m("table"),o=m("thead"),o.innerHTML='<tr><th>Name</th> <th>Group</th> <th>Prompt</th> <th class="thin"></th></tr>',r=v(),c=m("tbody");for(let u=0;u<a.length;u+=1)a[u].c();p(c,"class","vuetable-body"),p(l,"class","vuetable data fullwidth"),p(n,"class","vue-admin-tablepane tablepane"),p(t,"class","tableview")},m(u,f){T(u,t,f),s(t,n),s(n,l),s(l,o),s(l,r),s(l,c);for(let i=0;i<a.length;i+=1)a[i]&&a[i].m(c,null)},p(u,f){if(f&7){d=U(u[0].list);let i;for(i=0;i<d.length;i+=1){const h=At(u,d,i);a[i]?a[i].p(h,f):(a[i]=Ft(h),a[i].c(),a[i].m(c,null))}for(;i<a.length;i+=1)a[i].d(1);a.length=d.length}},d(u){u&&N(t),ut(a,u)}}}function pe(e){let t;return{c(){t=m("div"),t.innerHTML="<p>No Prompts exist yet.</p>",p(t,"class","zilch")},m(n,l){T(n,t,l)},p:I,d(n){n&&N(t)}}}function Ft(e){var P;let t,n,l,o=e[4].name+"",r,c,d,a,u,f=(((P=e[0].getGroup(e[4].group))==null?void 0:P.name)??"")+"",i,h,_,L,b=e[4].prompt+"",C,D,j,F,H,q,y;function G(...w){return e[3](e[4],...w)}return{c(){t=m("tr"),n=m("td"),l=m("a"),r=A(o),d=v(),a=m("td"),u=m("span"),i=A(f),h=v(),_=m("td"),L=m("span"),C=A(b),D=v(),j=m("td"),F=m("a"),H=v(),p(l,"href",c=e[1]+"/prompts/"+e[4].id),p(u,"class","light"),p(L,"class","light"),p(F,"title","Delete"),p(F,"role","button"),p(F,"href","#"),p(F,"class","delete icon")},m(w,g){T(w,t,g),s(t,n),s(n,l),s(l,r),s(t,d),s(t,a),s(a,u),s(u,i),s(t,h),s(t,_),s(_,L),s(L,C),s(t,D),s(t,j),s(j,F),s(t,H),q||(y=O(F,"click",Vt(G)),q=!0)},p(w,g){var E;e=w,g&1&&o!==(o=e[4].name+"")&&z(r,o),g&3&&c!==(c=e[1]+"/prompts/"+e[4].id)&&p(l,"href",c),g&1&&f!==(f=(((E=e[0].getGroup(e[4].group))==null?void 0:E.name)??"")+"")&&z(i,f),g&1&&b!==(b=e[4].prompt+"")&&z(C,b)},d(w){w&&N(t),q=!1,y()}}}function me(e){let t;function n(r,c){return r[0].list.length?fe:pe}let l=n(e),o=l(e);return{c(){o.c(),t=Rt()},m(r,c){o.m(r,c),T(r,t,c)},p(r,[c]){l===(l=n(r))&&o?o.p(r,c):(o.d(1),o=l(r),o&&(o.c(),o.m(t.parentNode,t)))},i:I,o:I,d(r){r&&N(t),o.d(r)}}}function he(e,t,n){let{prompts:l}=t,{url:o}=t;async function r(d,a){if(confirm("Delete the Prompt?"))try{await l.del(a),n(0,l)}catch{console.log("could not delete prompt"),alert("Failed to delete the prompt")}}const c=(d,a)=>r(a,d);return e.$$set=d=>{"prompts"in d&&n(0,l=d.prompts),"url"in d&&n(1,o=d.url)},[l,o,r,c]}class ge extends ${constructor(t){super(),Z(this,t,he,me,Y,{prompts:0,url:1})}}function Gt(e,t,n){const l=e.slice();return l[9]=t[n],l}function Nt(e){let t,n=e[9].name+"",l,o,r;return{c(){t=m("option"),l=A(n),t.__value=o=e[9].key,R(t,t.__value),t.selected=r=e[1].group?null:e[9].key==="default"},m(c,d){T(c,t,d),s(t,l)},p(c,d){d&1&&n!==(n=c[9].name+"")&&z(l,n),d&1&&o!==(o=c[9].key)&&(t.__value=o,R(t,t.__value)),d&3&&r!==(r=c[1].group?null:c[9].key==="default")&&(t.selected=r)},d(c){c&&N(t)}}}function _e(e){let t,n,l,o,r,c,d,a,u,f,i,h,_,L,b,C,D,j,F,H,q,y,G,P,w,g,E,x,K,M,W,tt,Q=U(e[0].groups),S=[];for(let k=0;k<Q.length;k+=1)S[k]=Nt(Gt(e,Q,k));return{c(){t=m("div"),n=m("div"),n.innerHTML='<label for="gpt-prompt-name">Name</label>',l=v(),o=m("div"),r=m("input"),c=v(),d=m("div"),a=m("div"),a.innerHTML='<label for="gpt-prompt-prompt">Prompt</label>',u=v(),f=m("div"),i=m("p"),h=A("Use "),_=m("code"),_.textContent="{{field.value}}",L=A(" to insert the value into the prompt. Other properties "),b=m("code"),b.textContent="{{field.name}}",C=A(", "),D=m("code"),D.textContent="{{field.label}}",j=A(", "),F=m("code"),F.textContent="{{field.instructions}}",H=A("."),q=v(),y=m("div"),G=m("textarea"),P=v(),w=m("div"),g=m("div"),g.innerHTML='<label for="group">Group</label>',E=v(),x=m("div"),K=m("div"),M=m("select");for(let k=0;k<S.length;k+=1)S[k].c();p(n,"class","heading"),p(r,"id","gpt-prompt-name"),p(r,"type","text"),p(r,"class","text fullwidth"),p(r,"name","name"),r.required=!0,p(o,"class","input ltr"),p(t,"class","field"),p(a,"class","heading"),p(f,"class","instructions"),p(G,"id","gpt-prompt-prompt"),p(G,"name","prompt"),p(G,"class","text nicetext fullwidth"),p(G,"rows","5"),G.required=!0,p(y,"class","input ltr"),p(d,"class","field width-100"),p(g,"class","heading"),p(M,"id","group"),p(M,"name","group"),M.required=!0,e[1].group===void 0&&st(()=>e[7].call(M)),p(K,"class","select"),p(x,"class","input ltr"),p(w,"class","field")},m(k,V){T(k,t,V),s(t,n),s(t,l),s(t,o),s(o,r),R(r,e[1].name),T(k,c,V),T(k,d,V),s(d,a),s(d,u),s(d,f),s(f,i),s(i,h),s(i,_),s(i,L),s(i,b),s(i,C),s(i,D),s(i,j),s(i,F),s(i,H),s(d,q),s(d,y),s(y,G),R(G,e[1].prompt),T(k,P,V),T(k,w,V),s(w,g),s(w,E),s(w,x),s(x,K),s(K,M);for(let B=0;B<S.length;B+=1)S[B]&&S[B].m(M,null);dt(M,e[1].group,!0),W||(tt=[O(r,"input",e[5]),O(G,"input",e[6]),O(M,"change",e[7])],W=!0)},p(k,[V]){if(V&3&&r.value!==k[1].name&&R(r,k[1].name),V&3&&R(G,k[1].prompt),V&3){Q=U(k[0].groups);let B;for(B=0;B<Q.length;B+=1){const Ct=Gt(k,Q,B);S[B]?S[B].p(Ct,V):(S[B]=Nt(Ct),S[B].c(),S[B].m(M,null))}for(;B<S.length;B+=1)S[B].d(1);S.length=Q.length}V&3&&dt(M,k[1].group)},i:I,o:I,d(k){k&&(N(t),N(c),N(d),N(P),N(w)),ut(S,k),W=!1,J(tt)}}}function be(e,t,n){let{prompts:l}=t,{form:o}=t,{id:r}=t,{url:c}=t,d=r?l.get(r):{};async function a(){try{await l.save(d),window.location=c}catch{console.log("could not save prompt"),alert("Could not save prompt")}}wt(()=>{o.addEventListener("submit",async h=>{h.preventDefault(),a()}),document.body.addEventListener("keydown",h=>{h.key.toLowerCase()!=="s"||!h.metaKey||(h.preventDefault(),a())}),o.removeAttribute("data-confirm-unload")});function u(){d.name=this.value,n(1,d),n(0,l)}function f(){d.prompt=this.value,n(1,d),n(0,l)}function i(){d.group=zt(this),n(1,d),n(0,l)}return e.$$set=h=>{"prompts"in h&&n(0,l=h.prompts),"form"in h&&n(2,o=h.form),"id"in h&&n(3,r=h.id),"url"in h&&n(4,c=h.url)},[l,d,o,r,c,u,f,i]}class ve extends ${constructor(t){super(),Z(this,t,be,_e,Y,{prompts:0,form:2,id:3,url:4})}}function Tt(e,t,n){const l=e.slice();return l[8]=t[n],l[9]=t,l[10]=n,l}function qt(e,t,n){const l=e.slice();return l[11]=t[n],l}function Dt(e){let t,n=e[11].name+"",l,o;return{c(){t=m("option"),l=A(n),t.__value=o=e[11].key,R(t,t.__value)},m(r,c){T(r,t,c),s(t,l)},p(r,c){c&1&&n!==(n=r[11].name+"")&&z(l,n),c&1&&o!==(o=r[11].key)&&(t.__value=o,R(t,t.__value))},d(r){r&&N(t)}}}function It(e){let t,n,l=e[8].name+"",o,r,c,d=e[8].handle+"",a,u,f,i=e[8].type+"",h,_,L,b,C,D,j,F,H,q=U(e[0].groups),y=[];for(let P=0;P<q.length;P+=1)y[P]=Dt(qt(e,q,P));function G(){e[6].call(C,e[9],e[10])}return{c(){t=m("tr"),n=m("td"),o=A(l),r=v(),c=m("td"),a=A(d),u=v(),f=m("td"),h=A(i),_=v(),L=m("td"),b=m("div"),C=m("select"),D=m("option");for(let P=0;P<y.length;P+=1)y[P].c();j=v(),D.__value="",R(D,D.__value),p(C,"id","group"),p(C,"name","group"),e[8].group===void 0&&st(G),p(b,"class","select"),p(t,"class","s-10")},m(P,w){T(P,t,w),s(t,n),s(n,o),s(t,r),s(t,c),s(c,a),s(t,u),s(t,f),s(f,h),s(t,_),s(t,L),s(L,b),s(b,C),s(C,D);for(let g=0;g<y.length;g+=1)y[g]&&y[g].m(C,null);dt(C,e[8].group,!0),s(t,j),F||(H=O(C,"change",G),F=!0)},p(P,w){if(e=P,w&2&&l!==(l=e[8].name+"")&&z(o,l),w&2&&d!==(d=e[8].handle+"")&&z(a,d),w&2&&i!==(i=e[8].type+"")&&z(h,i),w&1){q=U(e[0].groups);let g;for(g=0;g<q.length;g+=1){const E=qt(e,q,g);y[g]?y[g].p(E,w):(y[g]=Dt(E),y[g].c(),y[g].m(C,null))}for(;g<y.length;g+=1)y[g].d(1);y.length=q.length}w&3&&dt(C,e[8].group)},d(P){P&&N(t),ut(y,P),F=!1,H()}}}function ye(e){let t,n,l,o,r,c=U(e[1]),d=[];for(let a=0;a<c.length;a+=1)d[a]=It(Tt(e,c,a));return{c(){t=m("div"),n=m("table"),l=m("thead"),l.innerHTML='<tr><th scope="col">Label</th> <th scope="col">Handle</th> <th scope="col">Field type</th> <th scope="col">Group</th></tr>',o=v(),r=m("tbody");for(let a=0;a<d.length;a+=1)d[a].c();p(n,"class","data fullwidth"),p(t,"class","tableview tablepane")},m(a,u){T(a,t,u),s(t,n),s(n,l),s(n,o),s(n,r);for(let f=0;f<d.length;f+=1)d[f]&&d[f].m(r,null)},p(a,[u]){if(u&3){c=U(a[1]);let f;for(f=0;f<c.length;f+=1){const i=Tt(a,c,f);d[f]?d[f].p(i,u):(d[f]=It(i),d[f].c(),d[f].m(r,null))}for(;f<d.length;f+=1)d[f].d(1);d.length=c.length}},i:I,o:I,d(a){a&&N(t),ut(d,a)}}}function we(e,t,n){let{prompts:l}=t,{fields:o}=t,{form:r}=t,{enableAll:c}=t,{disableAll:d}=t,a=o.getCombined();async function u(){const i={};for(const h of a)i[h.id]=h.group;try{await o.saveFieldGroups(i),window.location.reload()}catch{console.log("could not save prompt"),alert("Could not save prompt")}}wt(()=>{r.addEventListener("submit",i=>{i.preventDefault(),u()}),document.body.addEventListener("keydown",i=>{i.key.toLowerCase()!=="s"||!i.metaKey||(i.preventDefault(),u())}),c.addEventListener("click",i=>{n(1,a=a.map(h=>(h.group||(h.group="default"),h)))}),d.addEventListener("click",i=>{n(1,a=a.map(h=>(h.group="",h)))})});function f(i,h){i[h].group=zt(this),n(1,a),n(0,l)}return e.$$set=i=>{"prompts"in i&&n(0,l=i.prompts),"fields"in i&&n(2,o=i.fields),"form"in i&&n(3,r=i.form),"enableAll"in i&&n(4,c=i.enableAll),"disableAll"in i&&n(5,d=i.disableAll)},[l,a,o,r,c,d,f]}class ke extends ${constructor(t){super(),Z(this,t,we,ye,Y,{prompts:0,fields:2,form:3,enableAll:4,disableAll:5})}}function Ot(e,t,n){const l=e.slice();return l[7]=t[n],l}function Bt(e){let t,n,l=e[7].name+"",o,r,c,d,a,u,f,i;function h(...b){return e[4](e[7],...b)}function _(...b){return e[5](e[7],...b)}function L(...b){return e[6](e[7],...b)}return{c(){t=m("div"),n=m("button"),o=A(l),r=v(),c=m("button"),d=v(),a=m("button"),u=v(),p(n,"type","button"),p(n,"class","svelte-xbcoyz"),p(c,"type","button"),p(c,"class","edit svelte-xbcoyz"),p(c,"data-icon","edit"),p(a,"type","button"),p(a,"class","delete svelte-xbcoyz"),p(a,"data-icon","trash"),p(t,"class","prompt svelte-xbcoyz")},m(b,C){T(b,t,C),s(t,n),s(n,o),s(t,r),s(t,c),s(t,d),s(t,a),s(t,u),f||(i=[O(n,"click",h),O(c,"click",_),O(a,"click",L)],f=!0)},p(b,C){e=b,C&3&&l!==(l=e[7].name+"")&&z(o,l)},d(b){b&&N(t),f=!1,J(i)}}}function Ee(e){let t,n,l,o,r,c,d,a,u=U(e[0].getByGroup(e[1])),f=[];for(let i=0;i<u.length;i+=1)f[i]=Bt(Ot(e,u,i));return{c(){t=m("div"),n=m("h5"),n.textContent="Select a prompt",l=v(),o=m("div");for(let i=0;i<f.length;i+=1)f[i].c();r=v(),c=m("button"),c.textContent="+ New Prompt",p(o,"class","list svelte-xbcoyz"),p(c,"type","button"),p(c,"class","btn"),p(t,"class","promptselector")},m(i,h){T(i,t,h),s(t,n),s(t,l),s(t,o);for(let _=0;_<f.length;_+=1)f[_]&&f[_].m(o,null);s(t,r),s(t,c),d||(a=O(c,"click",e[3]),d=!0)},p(i,[h]){if(h&7){u=U(i[0].getByGroup(i[1]));let _;for(_=0;_<u.length;_+=1){const L=Ot(i,u,_);f[_]?f[_].p(L,h):(f[_]=Bt(L),f[_].c(),f[_].m(o,null))}for(;_<f.length;_+=1)f[_].d(1);f.length=u.length}},i:I,o:I,d(i){i&&N(t),ut(f,i),d=!1,a()}}}function Ce(e,t,n){let{prompts:l}=t,{group:o}=t;const r=ft();function c(f){r("new")}const d=(f,i)=>r("select",{prompt:f}),a=(f,i)=>r("edit",{prompt:f}),u=(f,i)=>r("delete",{prompt:f});return e.$$set=f=>{"prompts"in f&&n(0,l=f.prompts),"group"in f&&n(1,o=f.group)},[l,o,r,c,d,a,u]}class Pe extends ${constructor(t){super(),Z(this,t,Ce,Ee,Y,{prompts:0,group:1})}}function Le(e){let t,n,l,o,r,c,d,a,u,f,i,h,_,L,b,C,D,j,F,H,q,y,G,P,w,g,E,x,K,M,W,tt,Q;return{c(){t=m("div"),n=m("h5"),n.textContent="Edit or create a prompt",l=v(),o=m("form"),r=m("div"),c=m("div"),c.innerHTML='<label for="gpt-prompt-name">Name</label>',d=v(),a=m("div"),u=m("input"),f=v(),i=m("div"),h=m("div"),h.innerHTML='<label for="gpt-prompt-prompt">Prompt</label>',_=v(),L=m("div"),b=m("p"),C=A("Use "),D=m("code"),D.textContent="{{field.value}}",j=A(" to insert the value into the prompt. Other properties "),F=m("code"),F.textContent="{{field.name}}",H=A(", "),q=m("code"),q.textContent="{{field.label}}",y=A(", "),G=m("code"),G.textContent="{{field.instructions}}",P=A("."),w=v(),g=m("div"),E=m("textarea"),x=v(),K=m("button"),K.textContent="Save",M=v(),W=m("button"),W.textContent="Cancel",p(n,"class","svelte-fda1us"),p(c,"class","heading"),p(u,"id","gpt-prompt-name"),p(u,"type","text"),p(u,"class","text fullwidth"),p(u,"name","name"),u.required=!0,p(a,"class","input ltr"),p(r,"class","field"),p(h,"class","heading"),p(D,"class","svelte-fda1us"),p(F,"class","svelte-fda1us"),p(q,"class","svelte-fda1us"),p(G,"class","svelte-fda1us"),p(L,"class","instructions"),p(E,"id","gpt-prompt-prompt"),p(E,"name","prompt"),p(E,"class","text nicetext fullwidth"),p(E,"rows","5"),E.required=!0,p(g,"class","input ltr"),p(i,"class","field width-100"),p(K,"class","btn submit"),p(W,"type","button"),p(W,"class","btn"),p(t,"class","editprompt svelte-fda1us")},m(S,k){T(S,t,k),s(t,n),s(t,l),s(t,o),s(o,r),s(r,c),s(r,d),s(r,a),s(a,u),R(u,e[0].name),s(o,f),s(o,i),s(i,h),s(i,_),s(i,L),s(L,b),s(b,C),s(b,D),s(b,j),s(b,F),s(b,H),s(b,q),s(b,y),s(b,G),s(b,P),s(i,w),s(i,g),s(g,E),R(E,e[0].prompt),s(o,x),s(o,K),s(o,M),s(o,W),tt||(Q=[O(u,"input",e[4]),O(E,"input",e[5]),O(W,"click",e[6]),O(o,"submit",Vt(e[2]))],tt=!0)},p(S,[k]){k&1&&u.value!==S[0].name&&R(u,S[0].name),k&1&&R(E,S[0].prompt)},i:I,o:I,d(S){S&&N(t),tt=!1,J(Q)}}}function Se(e,t,n){let{prompts:l}=t,{prompt:o}=t;const r=ft();async function c(f){try{const i=await l.save(o);r("save",{prompt:i})}catch(i){console.log("could not save prompt",i),alert("Could not save prompt")}}function d(){o.name=this.value,n(0,o)}function a(){o.prompt=this.value,n(0,o)}const u=f=>r("cancel");return e.$$set=f=>{"prompts"in f&&n(3,l=f.prompts),"prompt"in f&&n(0,o=f.prompt)},[o,r,c,l,d,a,u]}class Ae extends ${constructor(t){super(),Z(this,t,Se,Le,Y,{prompts:3,prompt:0})}}function Fe(e){let t,n,l,o,r,c,d,a,u,f,i;return{c(){t=m("div"),n=m("p"),l=A(e[0]),o=v(),r=m("button"),r.textContent="Ok",c=v(),d=m("button"),d.textContent="Regenerate",a=v(),u=m("button"),u.textContent="Cancel",p(r,"type","button"),p(r,"class","btn submit"),p(d,"type","button"),p(d,"class","btn"),p(u,"type","button"),p(u,"class","btn"),p(t,"class","generated-text")},m(h,_){T(h,t,_),s(t,n),s(n,l),s(t,o),s(t,r),s(t,c),s(t,d),s(t,a),s(t,u),f||(i=[O(r,"click",e[2]),O(d,"click",e[3]),O(u,"click",e[4])],f=!0)},p(h,[_]){_&1&&z(l,h[0])},i:I,o:I,d(h){h&&N(t),f=!1,J(i)}}}function Ge(e,t,n){let{text:l}=t;const o=ft(),r=a=>o("accept"),c=a=>o("regenerate"),d=a=>o("cancel");return e.$$set=a=>{"text"in a&&n(0,l=a.text)},[l,o,r,c,d]}class Ne extends ${constructor(t){super(),Z(this,t,Ge,Fe,Y,{text:0})}}const{window:jt}=le;function Te(e){let t,n;return t=new Pe({props:{prompts:e[0],group:e[1].group}}),t.$on("new",e[9]),t.$on("select",e[10]),t.$on("edit",e[12]),t.$on("delete",e[13]),{c(){kt(t.$$.fragment)},m(l,o){pt(t,l,o),n=!0},p(l,o){const r={};o&1&&(r.prompts=l[0]),o&2&&(r.group=l[1].group),t.$set(r)},i(l){n||(ot(t.$$.fragment,l),n=!0)},o(l){ct(t.$$.fragment,l),n=!1},d(l){mt(t,l)}}}function qe(e){let t,n;return t=new Ae({props:{prompts:e[0],prompt:e[3]}}),t.$on("save",e[11]),t.$on("cancel",e[17]),{c(){kt(t.$$.fragment)},m(l,o){pt(t,l,o),n=!0},p(l,o){const r={};o&1&&(r.prompts=l[0]),o&8&&(r.prompt=l[3]),t.$set(r)},i(l){n||(ot(t.$$.fragment,l),n=!0)},o(l){ct(t.$$.fragment,l),n=!1},d(l){mt(t,l)}}}function De(e){let t;function n(r,c){return r[5]?Be:Oe}let l=n(e),o=l(e);return{c(){o.c(),t=Rt()},m(r,c){o.m(r,c),T(r,t,c)},p(r,c){l===(l=n(r))&&o?o.p(r,c):(o.d(1),o=l(r),o&&(o.c(),o.m(t.parentNode,t)))},i:I,o:I,d(r){r&&N(t),o.d(r)}}}function Ie(e){let t,n;return t=new Ne({props:{text:e[6]}}),t.$on("accept",e[14]),t.$on("regenerate",e[15]),t.$on("cancel",e[16]),{c(){kt(t.$$.fragment)},m(l,o){pt(t,l,o),n=!0},p(l,o){const r={};o&64&&(r.text=l[6]),t.$set(r)},i(l){n||(ot(t.$$.fragment,l),n=!0)},o(l){ct(t.$$.fragment,l),n=!1},d(l){mt(t,l)}}}function Oe(e){let t;return{c(){t=m("p"),t.textContent="Generating..."},m(n,l){T(n,t,l)},p:I,d(n){n&&N(t)}}}function Be(e){let t,n;return{c(){t=m("p"),n=A(e[5])},m(l,o){T(l,t,o),s(t,n)},p(l,o){o&32&&z(n,l[5])},d(l){l&&N(t)}}}function je(e){let t,n,l,o,r,c,d;const a=[Ie,De,qe,Te],u=[];function f(i,h){return i[6]?0:i[4]?1:i[3]?2:3}return l=f(e),o=u[l]=a[l](e),{c(){t=m("div"),n=m("div"),o.c(),p(n,"class","gpt-popover svelte-hqfsef"),p(t,"class","gpt-popover-cont svelte-hqfsef")},m(i,h){T(i,t,h),s(t,n),u[l].m(n,null),e[18](t),r=!0,c||(d=[O(jt,"scroll",e[7]),O(jt,"click",e[8])],c=!0)},p(i,[h]){let _=l;l=f(i),l===_?u[l].p(i,h):(ce(),ct(u[_],1,1,()=>{u[_]=null}),ue(),o=u[l],o?o.p(i,h):(o=u[l]=a[l](i),o.c()),ot(o,1),o.m(n,null))},i(i){r||(ot(o),r=!0)},o(i){ct(o),r=!1},d(i){i&&N(t),u[l].d(),e[18](null),c=!1,J(d)}}}function Me(e,t,n){let{field:l}=t,{prompts:o}=t;const r=ft();let c,d=null,a=null,u=null,f=null,i=null;function h(){const g=l.input.cont.getBoundingClientRect(),E=c.offsetHeight;g.top<E?(n(2,c.style.top=g.bottom+"px",c),n(2,c.style.bottom="auto",c)):(n(2,c.style.top="auto",c),n(2,c.style.bottom=window.innerHeight-g.top+"px",c)),n(2,c.style.right=window.innerWidth-g.right+"px",c),n(2,c.style.maxWidth=l.input.cont.offsetWidth+"px",c)}function _(){h()}function L(g){Date.now()-d<100||console.log("e",g)}async function b(g){n(3,a={name:"",prompt:"",group:l.group}),await St(),h()}function C(g){const E=g.detail.prompt;y(E.prompt)}function D(g){g.detail.prompt,n(0,o),n(3,a=null)}async function j(g){n(3,a=g.detail.prompt),await St(),h()}async function F(g){const E=g.detail.prompt;try{await o.del(E),n(0,o)}catch{console.log("failed to generate"),alert("could not delete prompt")}}function H(g){l.setValue(i),r("close")}function q(g){n(6,i=null),y(u,!1)}async function y(g,E=!0){if(n(5,f=null),E){const x={field:{name:l.name(),label:l.label(),instructions:l.instructions(),value:l.value()}};n(4,u={prompt:g,ctx:x})}try{n(6,i=await o.execute(u.prompt,u.ctx))}catch(x){ee(x)?n(5,f=x.message):n(5,f="could not generate")}}wt(()=>{d=Date.now(),h()});const G=g=>{n(6,i=null),n(4,u=null)},P=g=>n(3,a=null);function w(g){_t[g?"unshift":"push"](()=>{c=g,n(2,c)})}return e.$$set=g=>{"field"in g&&n(1,l=g.field),"prompts"in g&&n(0,o=g.prompts)},[o,l,c,a,u,f,i,_,L,b,C,D,j,F,H,q,G,P,w]}class He extends ${constructor(t){super(),Z(this,t,Me,je,Y,{field:1,prompts:0})}}class xe{constructor(){this.prompts=null,this.current=null,this.currentField=null}setPrompts(t){this.prompts=t}open(t){if(this.current&&(this.current.$destroy(),this.current=null),this.currentField&&this.currentField.eq(t)){this.currentField=null;return}this.currentField=t;const n=new He({target:document.body,props:{field:t,prompts:this.prompts}});n.$on("close",l=>{n.$destroy(),this.currentField&&this.currentField.eq(t)&&(this.currentField=null,this.current=null)}),this.current=n}}class Qt{constructor(t){switch(this.fieldGen=t,this.contEl=t.parentNode.parentNode,this.group=t.dataset.group,this.input=null,this.labelEl=this.contEl.querySelector("label"),this.instructionsEl=this.contEl.querySelector(".instructions"),t.dataset.type){case"craft\\fields\\PlainText":this.input=new Re(t.parentNode);break;case"craft\\redactor\\Field":this.input=new Ve(t.parentNode);break;case"craft\\ckeditor\\Field":this.input=new ze(t.parentNode);break;default:console.log("unknown type: "+t.dataset.type)}}name(){return this.input.name()}label(){return this.labelEl?this.labelEl.innerText:""}instructions(){return this.instructionsEl?this.instructionsEl.innerText:""}value(){return this.input.value()}setValue(t){return this.input.setValue(t)}eq(t){return this.input.eq(t.input)}}class Et{constructor(t,n){this.type=t,this.cont=n}name(){throw new Error("could not get name of "+this.type)}value(){throw new Error("could not get value of "+this.type)}setValue(t){throw new Error("could not set value of "+this.type)}appendIcon(t){this.cont.appendChild(t)}eq(t){return this.type===t.type&&this.cont===t.cont}}class Re extends Et{constructor(t){super("plainText",t);const n=t.querySelector("input"),l=t.querySelector("textarea");this.el=n||l}name(){return this.el.name}value(){return this.el.value}setValue(t){this.el.value=t}appendIcon(t){this.el.nodeName.toLowerCase()==="input"&&t.classList.add("gpt-align-center"),this.cont.appendChild(t)}}class Ve extends Et{constructor(t){super("redactor",t),this.el=t.querySelector("textarea")}name(){return this.el.name}value(){return this.el.value}setValue(t){$R(this.el,"source.setCode",t)}}class ze extends Et{constructor(t){super("ckeditor",t),this.el=t.querySelector("textarea"),this.instance=this.cont.querySelector(".ck-editor__editable").ckeditorInstance}name(){return this.el.name}value(){return this.instance.getData()}setValue(t){this.instance.setData(t)}}const Xt=new xe;function Yt(e){const t=document.createElement("span");t.classList.add("gpt-click-icon"),t.innerText="ai",e.input.appendIcon(t),t.addEventListener("click",async n=>{Xt.open(e)})}function We(e,t){const n=document.createElement("div");return n.dataset.group=e,n.dataset.type=t,n}function Ue(e,t){let n=e.querySelector("input[name=title]");const l=t.getFieldGroup("title");if(n&&l){const o=We(l,"craft\\fields\\PlainText");n.parentNode.appendChild(o),n=new Qt(o),Yt(n)}}function Mt(e){const t=e.querySelectorAll(".gpt-content-generator-field[data-not-scanned]");for(const n of t){n.removeAttribute("data-not-scanned");const l=new Qt(n);l.input&&Yt(l)}}function Je(){if(!window.Craft)return null;const e=Craft.path;return e.startsWith("globals/")?"globals":e.startsWith("entries/")&&e.split("/").length>2?"entries":null}function Ke(e){const t=Je();if(!t)return console.log("not edit page");Xt.setPrompts(e);const n=document.getElementById("main-form");console.log("on Page",t),Ue(n,e),Mt(n),document.addEventListener("click",l=>{Mt(n)})}function Qe(e){const t=document.getElementById("prompts-list-table");if(!t)return;const n=new URL(t.dataset.url);new ge({target:t,props:{prompts:e,url:n.origin+n.pathname}})}function Xe(e){const t=document.getElementById("prompts-edit");if(!t)return;const n=document.getElementById("main-form");n.removeAttribute("novalidate");const l=new URL(t.dataset.url);new ve({target:t,props:{prompts:e,form:n,id:t.dataset.id,url:l.origin+l.pathname}})}async function Ye(e){const t=document.getElementById("gpt-fields-list");if(!t)return;const n=await yt.load(),l=document.getElementById("main-form");l.removeAttribute("novalidate");const o=document.getElementById("enable-all"),r=document.getElementById("disable-all");new ke({target:t,props:{prompts:e,fields:n,form:l,enableAll:o,disableAll:r}})}async function Ze(){const e=await vt.load();Qe(e),Xe(e),Ye(e),Ke(e)}Ze();
//# sourceMappingURL=main-2b04460e.js.map
