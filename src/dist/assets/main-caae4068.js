var Wt=Object.defineProperty;var Jt=(e,t,n)=>t in e?Wt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var at=(e,t,n)=>(Jt(e,typeof t!="symbol"?t+"":t,n),n);class Kt extends Error{constructor(t){super(t)}__promptsError__(){}}function Ut(e){return typeof e=="object"&&e!==null&&typeof e.__promptsError__=="function"}class ht{constructor(t){this.list=t.prompts,this.groups=t.groups,this.fieldGroups=t.fieldGroups}static async load(){const t=await fetch("/actions/gpt-content-generator/prompts/get");return new ht(await t.json())}get(t){return t=parseInt(t),this.list.find(n=>n.id===t)}getByGroup(t){return this.list.filter(n=>n.group===t)}canViewGroup(t){return!!this.getGroup(t)}canEditGroup(t){const n=typeof Craft=="object"&&Craft.userIsAdmin,o=this.getGroup(t);return((o==null?void 0:o.canEdit)??!1)||n}getGroup(t){return this.groups.find(n=>n.key===t)}getFieldGroup(t){return this.fieldGroups[t]??null}async save(t){const n=new FormData;t.id&&n.set("id",t.id),n.set("name",t.name),n.set("prompt",t.prompt),n.set("group",t.group);const o=await fetch("/actions/gpt-content-generator/prompts/save",{method:"POST",body:n,headers:{Accept:"application/json"}});if(!o.ok)throw new Error("not ok");return t=await o.json(),this.list.find(r=>r.id!=t.id?!1:(r.name=t.name,r.prompt=t.prompt,r.group=t.group,!0))||this.list.push(t),t}async del(t){const n=new FormData;if(n.set("id",t.id),!(await fetch("/actions/gpt-content-generator/prompts/delete",{method:"POST",body:n,headers:{Accept:"application/json"}})).ok)throw new Error("not ok");this.list=this.list.filter(l=>l.id!==t.id)}async execute(t,n){const o=new FormData;o.set("prompt",t),o.set("context",JSON.stringify(n));const l=await fetch("/actions/gpt-content-generator/prompts/execute",{method:"POST",body:o,headers:{Accept:"application/json"}});if(!l.ok)throw new Error("not ok");const r=await l.json();if(r!=null&&r.error)throw new Kt(r.error);return r}}class gt{constructor(t){this.list=t.fields,this.fieldGroups=t.fieldGroups,(!t.fieldGroups||Array.isArray(t.fieldGroups))&&(this.fieldGroups={})}static async load(){const t=await fetch("/actions/gpt-content-generator/settings/get-fields");return new gt(await t.json())}getCombined(){return this.list.map(t=>{const{id:n,handle:o,type:l,name:r}=t;return{id:n,handle:o,type:l,name:r,group:this.fieldGroups[n]??""}})}async saveFieldGroups(t){const n=new FormData;n.set("fieldGroups",JSON.stringify(t));const o=await fetch("/actions/gpt-content-generator/settings/save-field-groups",{method:"POST",body:n,headers:{Accept:"application/json"}});if(!o.ok)throw new Error("not ok");this.fieldGroups=await o.json()}}function D(){}function Ft(e){return e()}function vt(){return Object.create(null)}function B(e){e.forEach(Ft)}function Dt(e){return typeof e=="function"}function K(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function Qt(e){return Object.keys(e).length===0}const Xt=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function p(e,t){e.appendChild(t)}function S(e,t,n){e.insertBefore(t,n||null)}function P(e){e.parentNode&&e.parentNode.removeChild(e)}function st(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function g(e){return document.createElement(e)}function F(e){return document.createTextNode(e)}function y(){return F(" ")}function Yt(){return F("")}function q(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function Zt(e){return function(t){return t.preventDefault(),e.call(this,t)}}function m(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function $t(e){return Array.from(e.childNodes)}function H(e,t){t=""+t,e.data!==t&&(e.data=t)}function M(e,t){e.value=t??""}function it(e,t,n){for(let o=0;o<e.options.length;o+=1){const l=e.options[o];if(l.__value===t){l.selected=!0;return}}(!n||t!==void 0)&&(e.selectedIndex=-1)}function jt(e){const t=e.querySelector(":checked");return t&&t.__value}function te(e,t,{bubbles:n=!1,cancelable:o=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:o})}let nt;function et(e){nt=e}function xt(){if(!nt)throw new Error("Function called outside component initialization");return nt}function _t(e){xt().$$.on_mount.push(e)}function ct(){const e=xt();return(t,n,{cancelable:o=!1}={})=>{const l=e.$$.callbacks[t];if(l){const r=te(t,n,{cancelable:o});return l.slice().forEach(a=>{a.call(e,r)}),!r.defaultPrevented}return!0}}const Y=[],pt=[];let Z=[];const bt=[],Ot=Promise.resolve();let mt=!1;function Mt(){mt||(mt=!0,Ot.then(Bt))}function yt(){return Mt(),Ot}function ot(e){Z.push(e)}const ft=new Set;let X=0;function Bt(){if(X!==0)return;const e=nt;do{try{for(;X<Y.length;){const t=Y[X];X++,et(t),ee(t.$$)}}catch(t){throw Y.length=0,X=0,t}for(et(null),Y.length=0,X=0;pt.length;)pt.pop()();for(let t=0;t<Z.length;t+=1){const n=Z[t];ft.has(n)||(ft.add(n),n())}Z.length=0}while(Y.length);for(;bt.length;)bt.pop()();mt=!1,ft.clear(),et(e)}function ee(e){if(e.fragment!==null){e.update(),B(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(ot)}}function ne(e){const t=[],n=[];Z.forEach(o=>e.indexOf(o)===-1?t.push(o):n.push(o)),n.forEach(o=>o()),Z=t}const rt=new Set;let W;function oe(){W={r:0,c:[],p:W}}function le(){W.r||B(W.c),W=W.p}function R(e,t){e&&e.i&&(rt.delete(e),e.i(t))}function J(e,t,n,o){if(e&&e.o){if(rt.has(e))return;rt.add(e),W.c.push(()=>{rt.delete(e),o&&(n&&e.d(1),o())}),e.o(t)}else o&&o()}function z(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function lt(e){e&&e.c()}function $(e,t,n){const{fragment:o,after_update:l}=e.$$;o&&o.m(t,n),ot(()=>{const r=e.$$.on_mount.map(Ft).filter(Dt);e.$$.on_destroy?e.$$.on_destroy.push(...r):B(r),e.$$.on_mount=[]}),l.forEach(ot)}function tt(e,t){const n=e.$$;n.fragment!==null&&(ne(n.after_update),B(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function re(e,t){e.$$.dirty[0]===-1&&(Y.push(e),Mt(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function U(e,t,n,o,l,r,a=null,u=[-1]){const s=nt;et(e);const c=e.$$={fragment:null,ctx:[],props:r,update:D,not_equal:l,bound:vt(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(s?s.$$.context:[])),callbacks:vt(),dirty:u,skip_bound:!1,root:t.target||s.$$.root};a&&a(c.root);let f=!1;if(c.ctx=n?n(e,t.props||{},(i,d,...v)=>{const w=v.length?v[0]:d;return c.ctx&&l(c.ctx[i],c.ctx[i]=w)&&(!c.skip_bound&&c.bound[i]&&c.bound[i](w),f&&re(e,i)),d}):[],c.update(),f=!0,B(c.before_update),c.fragment=o?o(c.ctx):!1,t.target){if(t.hydrate){const i=$t(t.target);c.fragment&&c.fragment.l(i),i.forEach(P)}else c.fragment&&c.fragment.c();t.intro&&R(e.$$.fragment),$(e,t.target,t.anchor),Bt()}et(s)}class Q{constructor(){at(this,"$$");at(this,"$$set")}$destroy(){tt(this,1),this.$destroy=D}$on(t,n){if(!Dt(n))return D;const o=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return o.push(n),()=>{const l=o.indexOf(n);l!==-1&&o.splice(l,1)}}$set(t){this.$$set&&!Qt(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const ie="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(ie);function se(e){let t,n,o,l,r,a,u,s,c,f,i,d;return{c(){t=g("p"),n=F("Dynamically add the field value into the prompt with "),o=g("code"),o.textContent="{{field.value|raw}}",l=F(`
	. The field also provides
	`),r=g("code"),r.textContent="{{field.name}}",a=F(`
	,
	`),u=g("code"),u.textContent="{{field.label}}",s=F(`
	and
	`),c=g("code"),c.textContent="{{field.instructions}}",f=F(`
	. To access the current language, use
	`),i=g("code"),i.textContent="{{currentSite.language}}",d=F(`
	.`),m(o,"class","svelte-sv2vnm"),m(r,"class","svelte-sv2vnm"),m(u,"class","svelte-sv2vnm"),m(c,"class","svelte-sv2vnm"),m(i,"class","svelte-sv2vnm")},m(v,w){S(v,t,w),p(t,n),p(t,o),p(t,l),p(t,r),p(t,a),p(t,u),p(t,s),p(t,c),p(t,f),p(t,i),p(t,d)},p:D,i:D,o:D,d(v){v&&P(t)}}}class Vt extends Q{constructor(t){super(),U(this,t,null,se,K,{})}}function wt(e,t,n){const o=e.slice();return o[9]=t[n],o}function kt(e){let t,n=e[9].name+"",o,l,r,a;return{c(){t=g("option"),o=F(n),l=y(),t.__value=r=e[9].key,M(t,t.__value),t.selected=a=e[1].group?null:e[9].key==="default"},m(u,s){S(u,t,s),p(t,o),p(t,l)},p(u,s){s&1&&n!==(n=u[9].name+"")&&H(o,n),s&1&&r!==(r=u[9].key)&&(t.__value=r,M(t,t.__value)),s&3&&a!==(a=u[1].group?null:u[9].key==="default")&&(t.selected=a)},d(u){u&&P(t)}}}function ce(e){let t,n,o,l,r,a,u,s,c,f,i,d,v,w,N,k,I,T,O,j,C,b,x,E;i=new Vt({});let G=z(e[0].groups.filter(Et)),_=[];for(let h=0;h<G.length;h+=1)_[h]=kt(wt(e,G,h));return{c(){t=g("div"),n=g("div"),n.innerHTML='<label for="gpt-prompt-name">Name</label>',o=y(),l=g("div"),r=g("input"),a=y(),u=g("div"),s=g("div"),s.innerHTML='<label for="gpt-prompt-prompt">Prompt</label>',c=y(),f=g("div"),lt(i.$$.fragment),d=y(),v=g("div"),w=g("textarea"),N=y(),k=g("div"),I=g("div"),I.innerHTML='<label for="group">Group</label>',T=y(),O=g("div"),j=g("div"),C=g("select");for(let h=0;h<_.length;h+=1)_[h].c();m(n,"class","heading"),m(r,"id","gpt-prompt-name"),m(r,"type","text"),m(r,"class","text fullwidth"),m(r,"name","name"),r.required=!0,m(l,"class","input ltr"),m(t,"class","field"),m(s,"class","heading"),m(f,"class","instructions"),m(w,"id","gpt-prompt-prompt"),m(w,"name","prompt"),m(w,"class","text nicetext fullwidth"),m(w,"rows","5"),w.required=!0,m(v,"class","input ltr"),m(u,"class","field width-100"),m(I,"class","heading"),m(C,"id","group"),m(C,"name","group"),C.required=!0,e[1].group===void 0&&ot(()=>e[7].call(C)),m(j,"class","select"),m(O,"class","input ltr"),m(k,"class","field")},m(h,L){S(h,t,L),p(t,n),p(t,o),p(t,l),p(l,r),M(r,e[1].name),S(h,a,L),S(h,u,L),p(u,s),p(u,c),p(u,f),$(i,f,null),p(u,d),p(u,v),p(v,w),M(w,e[1].prompt),S(h,N,L),S(h,k,L),p(k,I),p(k,T),p(k,O),p(O,j),p(j,C);for(let A=0;A<_.length;A+=1)_[A]&&_[A].m(C,null);it(C,e[1].group,!0),b=!0,x||(E=[q(r,"input",e[5]),q(w,"input",e[6]),q(C,"change",e[7])],x=!0)},p(h,[L]){if(L&3&&r.value!==h[1].name&&M(r,h[1].name),L&3&&M(w,h[1].prompt),L&3){G=z(h[0].groups.filter(Et));let A;for(A=0;A<G.length;A+=1){const V=wt(h,G,A);_[A]?_[A].p(V,L):(_[A]=kt(V),_[A].c(),_[A].m(C,null))}for(;A<_.length;A+=1)_[A].d(1);_.length=G.length}L&3&&it(C,h[1].group)},i(h){b||(R(i.$$.fragment,h),b=!0)},o(h){J(i.$$.fragment,h),b=!1},d(h){h&&(P(t),P(a),P(u),P(N),P(k)),tt(i),st(_,h),x=!1,B(E)}}}const Et=e=>e.canEdit;function ue(e,t,n){let{prompts:o}=t,{form:l}=t,{id:r}=t,{url:a}=t,u=r?o.get(r):{};async function s(){try{await o.save(u),window.location=a}catch{console.log("could not save prompt"),alert("Could not save prompt")}}_t(()=>{l.addEventListener("submit",async d=>{d.preventDefault(),s()}),document.body.addEventListener("keydown",d=>{d.key.toLowerCase()!=="s"||!d.metaKey||(d.preventDefault(),l.querySelector('[type="submit"]').click())}),l.removeAttribute("data-confirm-unload")});function c(){u.name=this.value,n(1,u),n(0,o)}function f(){u.prompt=this.value,n(1,u),n(0,o)}function i(){u.group=jt(this),n(1,u),n(0,o)}return e.$$set=d=>{"prompts"in d&&n(0,o=d.prompts),"form"in d&&n(2,l=d.form),"id"in d&&n(3,r=d.id),"url"in d&&n(4,a=d.url)},[o,u,l,r,a,c,f,i]}class ae extends Q{constructor(t){super(),U(this,t,ue,ce,K,{prompts:0,form:2,id:3,url:4})}}function Ct(e,t,n){const o=e.slice();return o[8]=t[n],o[9]=t,o[10]=n,o}function Pt(e,t,n){const o=e.slice();return o[11]=t[n],o}function St(e){let t,n=e[11].name+"",o,l,r;return{c(){t=g("option"),o=F(n),l=y(),t.__value=r=e[11].key,M(t,t.__value)},m(a,u){S(a,t,u),p(t,o),p(t,l)},p(a,u){u&1&&n!==(n=a[11].name+"")&&H(o,n),u&1&&r!==(r=a[11].key)&&(t.__value=r,M(t,t.__value))},d(a){a&&P(t)}}}function At(e){let t,n,o=e[8].name+"",l,r,a,u=e[8].handle+"",s,c,f,i=e[8].type+"",d,v,w,N,k,I,T,O,j,C=z(e[0].groups),b=[];for(let E=0;E<C.length;E+=1)b[E]=St(Pt(e,C,E));function x(){e[6].call(k,e[9],e[10])}return{c(){t=g("tr"),n=g("td"),l=F(o),r=y(),a=g("td"),s=F(u),c=y(),f=g("td"),d=F(i),v=y(),w=g("td"),N=g("div"),k=g("select"),I=g("option");for(let E=0;E<b.length;E+=1)b[E].c();T=y(),I.__value="",M(I,I.__value),m(k,"id","group"),m(k,"name","group"),e[8].group===void 0&&ot(x),m(N,"class","select"),m(t,"class","s-10")},m(E,G){S(E,t,G),p(t,n),p(n,l),p(t,r),p(t,a),p(a,s),p(t,c),p(t,f),p(f,d),p(t,v),p(t,w),p(w,N),p(N,k),p(k,I);for(let _=0;_<b.length;_+=1)b[_]&&b[_].m(k,null);it(k,e[8].group,!0),p(t,T),O||(j=q(k,"change",x),O=!0)},p(E,G){if(e=E,G&2&&o!==(o=e[8].name+"")&&H(l,o),G&2&&u!==(u=e[8].handle+"")&&H(s,u),G&2&&i!==(i=e[8].type+"")&&H(d,i),G&1){C=z(e[0].groups);let _;for(_=0;_<C.length;_+=1){const h=Pt(e,C,_);b[_]?b[_].p(h,G):(b[_]=St(h),b[_].c(),b[_].m(k,null))}for(;_<b.length;_+=1)b[_].d(1);b.length=C.length}G&3&&it(k,e[8].group)},d(E){E&&P(t),st(b,E),O=!1,j()}}}function fe(e){let t,n,o,l,r,a=z(e[1]),u=[];for(let s=0;s<a.length;s+=1)u[s]=At(Ct(e,a,s));return{c(){t=g("div"),n=g("table"),o=g("thead"),o.innerHTML='<tr><th scope="col">Label</th> <th scope="col">Handle</th> <th scope="col">Field type</th> <th scope="col">Group</th></tr>',l=y(),r=g("tbody");for(let s=0;s<u.length;s+=1)u[s].c();m(n,"class","data fullwidth"),m(t,"class","tableview tablepane")},m(s,c){S(s,t,c),p(t,n),p(n,o),p(n,l),p(n,r);for(let f=0;f<u.length;f+=1)u[f]&&u[f].m(r,null)},p(s,[c]){if(c&3){a=z(s[1]);let f;for(f=0;f<a.length;f+=1){const i=Ct(s,a,f);u[f]?u[f].p(i,c):(u[f]=At(i),u[f].c(),u[f].m(r,null))}for(;f<u.length;f+=1)u[f].d(1);u.length=a.length}},i:D,o:D,d(s){s&&P(t),st(u,s)}}}function de(e,t,n){let{prompts:o}=t,{fields:l}=t,{form:r}=t,{enableAll:a}=t,{disableAll:u}=t,s=l.getCombined();async function c(){const i={};for(const d of s)i[d.id]=d.group;try{await l.saveFieldGroups(i),window.location.reload()}catch{console.log("could not save prompt"),alert("Could not save prompt")}}_t(()=>{r.addEventListener("submit",i=>{i.preventDefault(),c()}),document.body.addEventListener("keydown",i=>{i.key.toLowerCase()!=="s"||!i.metaKey||(i.preventDefault(),c())}),a.addEventListener("click",i=>{n(1,s=s.map(d=>(d.group||(d.group="default"),d)))}),u.addEventListener("click",i=>{n(1,s=s.map(d=>(d.group="",d)))})});function f(i,d){i[d].group=jt(this),n(1,s),n(0,o)}return e.$$set=i=>{"prompts"in i&&n(0,o=i.prompts),"fields"in i&&n(2,l=i.fields),"form"in i&&n(3,r=i.form),"enableAll"in i&&n(4,a=i.enableAll),"disableAll"in i&&n(5,u=i.disableAll)},[o,s,l,r,a,u,f]}class pe extends Q{constructor(t){super(),U(this,t,de,fe,K,{prompts:0,fields:2,form:3,enableAll:4,disableAll:5})}}function Gt(e,t,n){const o=e.slice();return o[7]=t[n],o}function Lt(e){let t,n,o,l,r;function a(...s){return e[5](e[7],...s)}function u(...s){return e[6](e[7],...s)}return{c(){t=g("button"),n=y(),o=g("button"),m(t,"type","button"),m(t,"class","edit svelte-xbcoyz"),m(t,"data-icon","edit"),m(o,"type","button"),m(o,"class","delete svelte-xbcoyz"),m(o,"data-icon","trash")},m(s,c){S(s,t,c),S(s,n,c),S(s,o,c),l||(r=[q(t,"click",a),q(o,"click",u)],l=!0)},p(s,c){e=s},d(s){s&&(P(t),P(n),P(o)),l=!1,B(r)}}}function Tt(e){let t,n,o=e[7].name+"",l,r,a=e[0].canEditGroup(e[1]),u,s,c;function f(...d){return e[4](e[7],...d)}let i=a&&Lt(e);return{c(){t=g("div"),n=g("button"),l=F(o),r=y(),i&&i.c(),u=y(),m(n,"type","button"),m(n,"class","svelte-xbcoyz"),m(t,"class","prompt svelte-xbcoyz")},m(d,v){S(d,t,v),p(t,n),p(n,l),p(t,r),i&&i.m(t,null),p(t,u),s||(c=q(n,"click",f),s=!0)},p(d,v){e=d,v&3&&o!==(o=e[7].name+"")&&H(l,o),v&3&&(a=e[0].canEditGroup(e[1])),a?i?i.p(e,v):(i=Lt(e),i.c(),i.m(t,u)):i&&(i.d(1),i=null)},d(d){d&&P(t),i&&i.d(),s=!1,c()}}}function qt(e){let t,n,o;return{c(){t=g("button"),t.textContent="+ New Prompt",m(t,"type","button"),m(t,"class","btn")},m(l,r){S(l,t,r),n||(o=q(t,"click",e[3]),n=!0)},p:D,d(l){l&&P(t),n=!1,o()}}}function me(e){let t,n,o,l,r,a=e[0].canEditGroup(e[1]),u=z(e[0].getByGroup(e[1])),s=[];for(let f=0;f<u.length;f+=1)s[f]=Tt(Gt(e,u,f));let c=a&&qt(e);return{c(){t=g("div"),n=g("h5"),n.textContent="Select a prompt",o=y(),l=g("div");for(let f=0;f<s.length;f+=1)s[f].c();r=y(),c&&c.c(),m(l,"class","list svelte-xbcoyz"),m(t,"class","promptselector")},m(f,i){S(f,t,i),p(t,n),p(t,o),p(t,l);for(let d=0;d<s.length;d+=1)s[d]&&s[d].m(l,null);p(t,r),c&&c.m(t,null)},p(f,[i]){if(i&7){u=z(f[0].getByGroup(f[1]));let d;for(d=0;d<u.length;d+=1){const v=Gt(f,u,d);s[d]?s[d].p(v,i):(s[d]=Tt(v),s[d].c(),s[d].m(l,null))}for(;d<s.length;d+=1)s[d].d(1);s.length=u.length}i&3&&(a=f[0].canEditGroup(f[1])),a?c?c.p(f,i):(c=qt(f),c.c(),c.m(t,null)):c&&(c.d(1),c=null)},i:D,o:D,d(f){f&&P(t),st(s,f),c&&c.d()}}}function he(e,t,n){let{prompts:o}=t,{group:l}=t;const r=ct();function a(f){r("new")}const u=(f,i)=>r("select",{prompt:f}),s=(f,i)=>r("edit",{prompt:f}),c=(f,i)=>r("delete",{prompt:f});return e.$$set=f=>{"prompts"in f&&n(0,o=f.prompts),"group"in f&&n(1,l=f.group)},[o,l,r,a,u,s,c]}class ge extends Q{constructor(t){super(),U(this,t,he,me,K,{prompts:0,group:1})}}function _e(e){let t,n,o,l,r,a,u,s,c,f,i,d,v,w,N,k,I,T,O,j,C,b,x,E,G;return N=new Vt({}),{c(){t=g("div"),n=g("h5"),n.textContent="Edit or create a prompt",o=y(),l=g("form"),r=g("div"),a=g("div"),a.innerHTML='<label for="gpt-prompt-name">Name</label>',u=y(),s=g("div"),c=g("input"),f=y(),i=g("div"),d=g("div"),d.innerHTML='<label for="gpt-prompt-prompt">Prompt</label>',v=y(),w=g("div"),lt(N.$$.fragment),k=y(),I=g("div"),T=g("textarea"),O=y(),j=g("button"),j.textContent="Save",C=y(),b=g("button"),b.textContent="Cancel",m(n,"class","svelte-bl79w9"),m(a,"class","heading"),m(c,"id","gpt-prompt-name"),m(c,"type","text"),m(c,"class","text fullwidth"),m(c,"name","name"),c.required=!0,m(s,"class","input ltr"),m(r,"class","field"),m(d,"class","heading"),m(w,"class","instructions"),m(T,"id","gpt-prompt-prompt"),m(T,"name","prompt"),m(T,"class","text nicetext fullwidth"),m(T,"rows","5"),T.required=!0,m(I,"class","input ltr"),m(i,"class","field width-100"),m(j,"class","btn submit"),m(b,"type","button"),m(b,"class","btn"),m(t,"class","editprompt svelte-bl79w9")},m(_,h){S(_,t,h),p(t,n),p(t,o),p(t,l),p(l,r),p(r,a),p(r,u),p(r,s),p(s,c),M(c,e[0].name),p(l,f),p(l,i),p(i,d),p(i,v),p(i,w),$(N,w,null),p(i,k),p(i,I),p(I,T),M(T,e[0].prompt),p(l,O),p(l,j),p(l,C),p(l,b),x=!0,E||(G=[q(c,"input",e[4]),q(T,"input",e[5]),q(b,"click",e[6]),q(l,"submit",Zt(e[2]))],E=!0)},p(_,[h]){h&1&&c.value!==_[0].name&&M(c,_[0].name),h&1&&M(T,_[0].prompt)},i(_){x||(R(N.$$.fragment,_),x=!0)},o(_){J(N.$$.fragment,_),x=!1},d(_){_&&P(t),tt(N),E=!1,B(G)}}}function ve(e,t,n){let{prompts:o}=t,{prompt:l}=t;const r=ct();async function a(f){try{const i=await o.save(l);r("save",{prompt:i})}catch(i){console.log("could not save prompt",i),alert("Could not save prompt")}}function u(){l.name=this.value,n(0,l)}function s(){l.prompt=this.value,n(0,l)}const c=f=>r("cancel");return e.$$set=f=>{"prompts"in f&&n(3,o=f.prompts),"prompt"in f&&n(0,l=f.prompt)},[l,r,a,o,u,s,c]}class be extends Q{constructor(t){super(),U(this,t,ve,_e,K,{prompts:3,prompt:0})}}function ye(e){let t,n,o,l,r,a,u,s,c,f,i;return{c(){t=g("div"),n=g("div"),o=F(e[0]),l=y(),r=g("button"),r.textContent="Ok",a=y(),u=g("button"),u.textContent="Regenerate",s=y(),c=g("button"),c.textContent="Cancel",m(n,"class","generated-text-content svelte-sxa43"),m(r,"type","button"),m(r,"class","btn submit"),m(u,"type","button"),m(u,"class","btn"),m(c,"type","button"),m(c,"class","btn"),m(t,"class","generated-text")},m(d,v){S(d,t,v),p(t,n),p(n,o),p(t,l),p(t,r),p(t,a),p(t,u),p(t,s),p(t,c),f||(i=[q(r,"click",e[2]),q(u,"click",e[3]),q(c,"click",e[4])],f=!0)},p(d,[v]){v&1&&H(o,d[0])},i:D,o:D,d(d){d&&P(t),f=!1,B(i)}}}function we(e,t,n){let{text:o}=t;const l=ct(),r=s=>l("accept"),a=s=>l("regenerate"),u=s=>l("cancel");return e.$$set=s=>{"text"in s&&n(0,o=s.text)},[o,l,r,a,u]}class ke extends Q{constructor(t){super(),U(this,t,we,ye,K,{text:0})}}const{window:dt}=Xt;function Ee(e){let t,n;return t=new ge({props:{prompts:e[0],group:e[1].group}}),t.$on("new",e[10]),t.$on("select",e[11]),t.$on("edit",e[13]),t.$on("delete",e[14]),{c(){lt(t.$$.fragment)},m(o,l){$(t,o,l),n=!0},p(o,l){const r={};l&1&&(r.prompts=o[0]),l&2&&(r.group=o[1].group),t.$set(r)},i(o){n||(R(t.$$.fragment,o),n=!0)},o(o){J(t.$$.fragment,o),n=!1},d(o){tt(t,o)}}}function Ce(e){let t,n;return t=new be({props:{prompts:e[0],prompt:e[3]}}),t.$on("save",e[12]),t.$on("cancel",e[18]),{c(){lt(t.$$.fragment)},m(o,l){$(t,o,l),n=!0},p(o,l){const r={};l&1&&(r.prompts=o[0]),l&8&&(r.prompt=o[3]),t.$set(r)},i(o){n||(R(t.$$.fragment,o),n=!0)},o(o){J(t.$$.fragment,o),n=!1},d(o){tt(t,o)}}}function Pe(e){let t;function n(r,a){return r[5]?Ge:Ae}let o=n(e),l=o(e);return{c(){l.c(),t=Yt()},m(r,a){l.m(r,a),S(r,t,a)},p(r,a){o===(o=n(r))&&l?l.p(r,a):(l.d(1),l=o(r),l&&(l.c(),l.m(t.parentNode,t)))},i:D,o:D,d(r){r&&P(t),l.d(r)}}}function Se(e){let t,n;return t=new ke({props:{text:e[6]}}),t.$on("accept",e[15]),t.$on("regenerate",e[16]),t.$on("cancel",e[17]),{c(){lt(t.$$.fragment)},m(o,l){$(t,o,l),n=!0},p(o,l){const r={};l&64&&(r.text=o[6]),t.$set(r)},i(o){n||(R(t.$$.fragment,o),n=!0)},o(o){J(t.$$.fragment,o),n=!1},d(o){tt(t,o)}}}function Ae(e){let t;return{c(){t=g("p"),t.textContent="Generating..."},m(n,o){S(n,t,o)},p:D,d(n){n&&P(t)}}}function Ge(e){let t,n;return{c(){t=g("p"),n=F(e[5])},m(o,l){S(o,t,l),p(t,n)},p(o,l){l&32&&H(n,o[5])},d(o){o&&P(t)}}}function Le(e){let t,n,o,l,r,a,u;const s=[Se,Pe,Ce,Ee],c=[];function f(i,d){return i[6]!==null?0:i[4]?1:i[3]?2:3}return o=f(e),l=c[o]=s[o](e),{c(){t=g("div"),n=g("div"),l.c(),m(n,"class","gpt-popover svelte-hqfsef"),m(t,"class","gpt-popover-cont svelte-hqfsef")},m(i,d){S(i,t,d),p(t,n),c[o].m(n,null),e[19](t),r=!0,a||(u=[q(dt,"scroll",e[7]),q(dt,"resize",e[8]),q(dt,"click",e[9])],a=!0)},p(i,[d]){let v=o;o=f(i),o===v?c[o].p(i,d):(oe(),J(c[v],1,1,()=>{c[v]=null}),le(),l=c[o],l?l.p(i,d):(l=c[o]=s[o](i),l.c()),R(l,1),l.m(n,null))},i(i){r||(R(l),r=!0)},o(i){J(l),r=!1},d(i){i&&P(t),c[o].d(),e[19](null),a=!1,B(u)}}}function Te(e,t,n){const o=ct();let{field:l}=t,{prompts:r}=t,a,u=null,s=null,c=null,f=null,i=null;function d(){const h=l.input.cont.getBoundingClientRect(),L=a.offsetHeight;h.top<L?(n(2,a.style.top=h.bottom+"px",a),n(2,a.style.bottom="auto",a)):(n(2,a.style.top="auto",a),n(2,a.style.bottom=window.innerHeight-h.top+"px",a)),n(2,a.style.right=window.innerWidth-h.right+"px",a),n(2,a.style.maxWidth=Math.min(800,l.input.cont.offsetWidth)+"px",a)}function v(){d()}function w(){d()}function N(h){Date.now()-u<100||a.contains(h.target)||!document.body.contains(h.target)||c||o("close")}async function k(h){n(3,s={name:"",prompt:"",group:l.group}),await yt(),d()}function I(h){const L=h.detail.prompt;x(L.prompt)}function T(h){h.detail.prompt,n(0,r),n(3,s=null)}async function O(h){n(3,s=h.detail.prompt),await yt(),d()}async function j(h){const L=h.detail.prompt;try{await r.del(L),n(0,r)}catch{console.log("failed to generate"),alert("could not delete prompt")}}function C(h){l.setValue(i),o("close")}function b(h){n(6,i=null),x(c,!1)}async function x(h,L=!0){var A;if(n(5,f=null),L){const V={field:{name:l.name(),label:l.label(),instructions:l.instructions(),value:l.value()}};(A=window==null?void 0:window.Craft)!=null&&A.siteId&&(V.siteId=Craft.siteId),n(4,c={prompt:h,ctx:V})}try{n(6,i=await r.execute(c.prompt,c.ctx))}catch(V){Ut(V)?n(5,f=V.message):n(5,f="could not generate")}}_t(()=>{u=Date.now(),d()});const E=h=>{n(6,i=null),n(4,c=null)},G=h=>n(3,s=null);function _(h){pt[h?"unshift":"push"](()=>{a=h,n(2,a)})}return e.$$set=h=>{"field"in h&&n(1,l=h.field),"prompts"in h&&n(0,r=h.prompts)},[r,l,a,s,c,f,i,v,w,N,k,I,T,O,j,C,b,E,G,_]}class qe extends Q{constructor(t){super(),U(this,t,Te,Le,K,{field:1,prompts:0})}}class Ne{constructor(){this.prompts=null,this.actives=[],this.id=0}setPrompts(t){this.prompts=t}open(t){let n=!1;if(this.actives=this.actives.filter(r=>r.field.eq(t)?(r.comp.$destroy(),n=!0,!1):!0),n)return;const o=this.id++,l=new qe({target:document.body,props:{field:t,prompts:this.prompts}});l.$on("close",r=>{l.$destroy(),this.actives=this.actives.filter(a=>a.id!==o)}),this.actives.push({id:o,comp:l,field:t})}}class Ht{constructor(t){switch(this.fieldGen=t,this.contEl=t.parentNode.parentNode,this.group=t.dataset.group,this.input=null,this.labelEl=this.contEl.querySelector("label"),this.instructionsEl=this.contEl.querySelector(".instructions"),t.dataset.type){case"craft\\fields\\PlainText":this.input=new Ie(t.parentNode);break;case"craft\\redactor\\Field":this.input=new Fe(t.parentNode);break;case"craft\\ckeditor\\Field":this.input=new De(t.parentNode);break;case"spicyweb\\tinymce\\fields\\TinyMCE":this.input=new je(t.parentNode);break;default:console.log("unknown type: "+t.dataset.type)}}name(){return this.input.name()}label(){return this.labelEl?this.labelEl.innerText:""}instructions(){return this.instructionsEl?this.instructionsEl.innerText:""}value(){return this.input.value()}setValue(t){return this.input.setValue(t)}eq(t){return this.input.eq(t.input)}}class ut{constructor(t,n){this.type=t,this.cont=n}name(){throw new Error("could not get name of "+this.type)}value(){throw new Error("could not get value of "+this.type)}setValue(t){throw new Error("could not set value of "+this.type)}appendIcon(t){this.cont.appendChild(t)}eq(t){return this.type===t.type&&this.cont===t.cont}}class Ie extends ut{constructor(t){super("plainText",t);const n=t.querySelector("input"),o=t.querySelector("textarea");this.el=n||o}name(){return this.el.name}value(){return this.el.value}setValue(t){this.el.value=t}appendIcon(t){this.el.nodeName.toLowerCase()==="input"&&t.classList.add("gpt-align-center"),this.cont.appendChild(t),this.el.style.paddingRight="30px"}}class Fe extends ut{constructor(t){super("redactor",t),this.el=t.querySelector("textarea")}name(){return this.el.name}value(){return this.el.value}setValue(t){$R(this.el,"source.setCode",t)}}class De extends ut{constructor(t){super("ckeditor",t),this.el=t.querySelector("textarea"),this.instance=this.cont.querySelector(".ck-editor__editable").ckeditorInstance}name(){return this.el.name}value(){return this.instance.getData()}setValue(t){this.instance.setData(t)}}class je extends ut{constructor(t){super("tinymce",t),this.el=t.querySelector("textarea")}name(){return this.el.name}value(){return this.el.value}setValue(t){if(typeof window.tinymce>"u"){console.log("tinymce is not defined");return}window.tinymce.get(this.el.id).setContent(t)}}const Rt=new Ne;function zt(e){const t=document.createElement("span");t.classList.add("gpt-click-icon"),t.innerText="ai",e.input.appendIcon(t),t.addEventListener("click",async n=>{Rt.open(e)})}function xe(e,t){const n=document.createElement("div");return n.dataset.group=e,n.dataset.type=t,n}function Nt(e){const t=e.getFieldGroup("title");if(!t)return;const n=document.querySelectorAll("input[type=text]:not([data-gpt-scanned])");for(const o of n){if(o.setAttribute("data-gpt-scanned",""),o.name!=="title"&&!o.name.endsWith("[title]"))continue;const l=xe(t,"craft\\fields\\PlainText");o.parentNode.appendChild(l);const r=new Ht(l);zt(r)}}function It(){const e=document.querySelectorAll(".gpt-content-generator-field[data-not-scanned]");for(const t of e){t.removeAttribute("data-not-scanned");const n=new Ht(t);n.input&&zt(n)}}function Oe(e){Rt.setPrompts(e),Nt(e),It(),document.addEventListener("click",t=>{setTimeout(()=>{Nt(e),It()},500)})}function Me(e){const t=document.getElementById("prompts-edit");if(!t)return;const n=document.getElementById("main-form");n.removeAttribute("novalidate");const o=new URL(t.dataset.url);new ae({target:t,props:{prompts:e,form:n,id:t.dataset.id,url:o.origin+o.pathname}})}async function Be(e){const t=document.getElementById("gpt-fields-list");if(!t)return;const n=await gt.load(),o=document.getElementById("main-form");o.removeAttribute("novalidate");const l=document.getElementById("enable-all"),r=document.getElementById("disable-all");new pe({target:t,props:{prompts:e,fields:n,form:o,enableAll:l,disableAll:r}})}async function Ve(){const e=await ht.load();Me(e),Be(e),Oe(e)}Ve();
//# sourceMappingURL=main-caae4068.js.map
